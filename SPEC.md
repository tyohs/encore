# 🎤 みんカラ - 仕様書

## 1. 概要

### 1.1 プロダクト名
**みんカラ**（みんなで作る、みんなのカラオケ）

### 1.2 コンセプト
カラオケを「待つ時間」から「参加する時間」に変える新感覚Webアプリケーション。
歌う人だけでなく、全員がライブを作る主役になれる。

### 1.3 解決する課題
| 従来のカラオケ | みんカラ |
|---------------|---------|
| 歌わない人は暇 | バンドメンバーとしてリズムゲーム参加 |
| 一人だけが主役 | 全員でライブを作る体験 |
| リアクションが薄い | コール&リクエストがリアルタイム表示 |
| スマホいじりがち | ゲーム性で没入感UP |

---

## 2. 機能仕様

### 2.1 ルームシステム
- ルーム作成：6桁のルームコードを自動生成
- ルーム参加：ルームコード入力で参加
- 複数デバイス間でBroadcastChannel APIによるリアルタイム同期

### 2.2 役割（ロール）

#### 🎤 シンガーモード
| 機能 | 説明 |
|------|------|
| 曲選択 | 4曲から選択 |
| 歌詞表示 | タイムライン同期で現在の歌詞をハイライト |
| 盛り上がりゲージ | 0-100%で会場の盛り上がりを可視化 |
| リクエスト受信 | バンド/オーディエンスからのリクエストを表示 |
| コール受信 | コールが画面中央にポップアップ表示 |
| メッセージ受信 | カスタムメッセージがニコニコ動画風に流れる |
| ファンサ完了 | リクエストに「OK！」ボタンで応答 |

#### 🎸 バンドモード
| 機能 | 説明 |
|------|------|
| 楽器選択 | ドラム/ギター/キーボード/ベースの4種 |
| リズムゲーム | ノートをタップして判定（PERFECT/GREAT/GOOD/MISS） |
| スコア/コンボ | 上部に常時表示 |
| 4方向スワイプコール | 上下左右スワイプで異なるコール発動 |
| リクエスト送信 | 歌手への特別リクエスト（30秒クールダウン） |
| メッセージ送信 | カスタムテキストを歌手に送信 |
| MV背景 | MP4アップロードで背景に動画表示 |
| 途中停止ボタン | ゲームを中断して結果画面へ |
| 振動フィードバック | 判定に応じた振動パターン |

#### 🔦 オーディエンスモード
| 機能 | 説明 |
|------|------|
| ペンライト | タップ/スワイプで振る、色変更可能 |
| プリセットコール | 4種のコールボタン |
| ファンサリクエスト | heart/wave/peaceの3種 |
| カスタムメッセージ | テキスト入力して歌手に送信 |

### 2.3 コールシステム

#### 通常コール（4方向スワイプ対応）
| 方向 | コール | コスト |
|------|--------|--------|
| ⬆️ 上 | 🎉 イェーイ！ | 200pt |
| ⬇️ 下 | 🔥 フゥー！ | 300pt |
| ⬅️ 左 | 💖 かわいい！ | 300pt |
| ➡️ 右 | ⭐ サイコー！ | 500pt |

#### 歌手リクエスト（30秒クールダウン）
| リクエスト | コスト |
|-----------|--------|
| 👋 手を振って！ | 1500pt |
| ✌️ ピース！ | 2000pt |
| 🫶 ハート作って！ | 2500pt |
| 😘 ウィンクして！ | 3000pt |

### 2.4 リズムゲーム

#### 判定
| 判定 | タイミング | 倍率 |
|------|-----------|------|
| PERFECT | ±50ms | ×1.5 |
| GREAT | ±100ms | ×1.2 |
| GOOD | ±150ms | ×1.0 |
| MISS | それ以外 | ×0 |

#### スペシャルノート
- 星マーク（⭐）で表示
- ヒット時に画面全体が金色フラッシュ
- パーティクルエフェクト発生
- 判定テキスト拡大＋「✨」追加

### 2.5 MV背景機能
- 曲選択画面でMP4アップロード
- ゲーム画面の背景レイヤーに表示（opacity: 50%）
- オーディオと自動同期（±100ms以上ずれたら同期）

### 2.6 リアルタイム同期
- BroadcastChannel APIによるタブ間通信
- 同期対象：
  - プレイヤー参加/退出
  - コール発動
  - リクエスト送信
  - カスタムメッセージ

---

## 3. 収録曲

| # | タイトル | BPM | ジャンル |
|---|---------|-----|---------|
| 1 | 仰げば尊し | 96 | 卒業ソング |
| 2 | シャイニングスター | 158 | J-POP |
| 3 | Escort | 80 | Instrumental |
| 4 | バーニングハート | 142 | Rock |

---

## 4. 技術仕様

### 4.1 技術スタック
| カテゴリ | 技術 |
|---------|------|
| フレームワーク | Next.js 16 (App Router) |
| 言語 | TypeScript |
| スタイリング | Tailwind CSS |
| アニメーション | Framer Motion |
| 状態管理 | Zustand |
| リアルタイム通信 | BroadcastChannel API |

### 4.2 ディレクトリ構成
```
src/
├── app/
│   ├── page.tsx              # ホーム（ルーム作成/参加）
│   ├── layout.tsx            # レイアウト
│   ├── globals.css           # グローバルスタイル
│   └── room/[roomId]/
│       ├── page.tsx          # ロール選択
│       ├── singer/page.tsx   # シンガーモード
│       ├── band/page.tsx     # バンドモード
│       ├── audience/page.tsx # オーディエンスモード
│       └── result/page.tsx   # 結果画面
├── components/
│   ├── BandGame.tsx          # リズムゲーム本体
│   ├── InstrumentSelect.tsx  # 楽器選択UI
│   ├── Note.tsx              # ノート描画
│   ├── LyricsDisplay.tsx     # 歌詞表示
│   ├── ExcitementGauge.tsx   # 盛り上がりゲージ
│   ├── PenLight.tsx          # ペンライト
│   ├── CallButton.tsx        # コールボタン
│   └── FansaButton.tsx       # ファンサボタン
├── store/
│   ├── gameStore.ts          # ゲーム全体の状態
│   ├── roomStore.ts          # ルーム同期
│   └── rhythmGameStore.ts    # リズムゲーム状態
├── data/
│   ├── songs.ts              # 曲データ
│   └── charts.ts             # 譜面データ
└── types/
    └── index.ts              # 型定義
```

### 4.3 主要な型定義
```typescript
// 楽器タイプ
type InstrumentType = 'drums' | 'guitar' | 'keyboard' | 'bass';

// ノートタイプ
type NoteType = 'normal' | 'special';

// 判定
type Judgment = 'perfect' | 'great' | 'good' | 'miss';

// 同期イベント
type SyncEventType = 'player_join' | 'player_leave' | 'call' | 'request' | 'message';
```

---

## 5. UI/UXデザイン

### 5.1 デザインコンセプト
- **Glassmorphism**：磨りガラス風の半透明カード
- **ダークモード**：紫〜青のグラデーション背景
- **マイクロアニメーション**：Framer Motionによる滑らかな動き

### 5.2 カラーパレット
| 用途 | 色 |
|------|-----|
| 背景 | #1a1a2e → #16213e グラデーション |
| アクセント | #a855f7（紫） |
| 成功 | #22c55e（緑） |
| 警告 | #fbbf24（黄） |
| エラー | #ef4444（赤） |

### 5.3 振動パターン
| 判定 | パターン |
|------|---------|
| PERFECT | 30ms |
| GREAT | 20ms |
| GOOD | 10ms |
| MISS | 100ms |
| コール発動 | 50-30-50ms |
| リクエスト発動 | 100-50-100-50-100ms |

---

## 6. 今後の展望

### 6.1 短期（1-2週間）
- [ ] PWA対応（オフライン対応、ホーム画面追加）
- [ ] 実際の音源ファイル追加
- [ ] Vercelデプロイ

### 6.2 中期（1-2ヶ月）
- [ ] WebSocket対応（異なるデバイス間の完全同期）
- [ ] YouTube/カラオケAPI連携
- [ ] スコアランキング
- [ ] 決めポーズタイム機能
- [ ] ウェーブ機能

### 6.3 長期
- [ ] Capacitor化（App Store対応）
- [ ] AR/VRライブ体験
- [ ] AI歌詞生成
- [ ] 対戦モード

---

## 7. スマホアプリ対応戦略

### 推奨アプローチ
```
Step 1: PWA化（今すぐ）
        ↓
Step 2: Capacitor化（App Store対応が必要になったら）
```

### 技術比較
| 項目 | PWA | Capacitor | React Native |
|------|-----|-----------|--------------|
| 開発コスト | ◎ 低 | ○ 中 | △ 高 |
| コード再利用 | ◎ 100% | ○ 90% | × 10% |
| ネイティブ感 | △ | ○ | ◎ |
| App Store | × | ◎ | ◎ |
